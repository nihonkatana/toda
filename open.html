<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>掲示場ナビをひらく</title>
    <style>
        :root {
            --pad: 18px;
        }

        body {
            margin: 0;
            background: #fff;
            color: #111;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
        }

        .wrap {
            max-width: 720px;
            margin: 0 auto;
            padding: 20px var(--pad) 30px;
        }

        .title {
            font-weight: 900;
            line-height: 1.2;
            font-size: 30px;
            margin: 6px 0 10px;
        }

        .sub {
            font-size: 18px;
            line-height: 1.5;
            margin: 0 0 14px;
            color: #111;
        }

        .card {
            border: 2px solid #e5e5e5;
            border-radius: 18px;
            padding: 14px;
            margin: 14px 0;
        }

        .warn {
            border-color: #bfe6bf;
            background: #f3fff3;
        }

        .device {
            font-size: 18px;
            font-weight: 900;
            margin: 0 0 6px;
        }

        .hint {
            font-size: 16px;
            line-height: 1.6;
            margin: 0;
            color: #222;
        }

        .bigbtn {
            display: block;
            width: 100%;
            padding: 18px 14px;
            border-radius: 18px;
            text-align: center;
            text-decoration: none;
            font-weight: 900;
            font-size: 24px;
            border: 2px solid #111;
            background: #111;
            color: #fff;
            box-sizing: border-box;
            margin: 12px 0;
        }

        .bigbtn.secondary {
            background: #fff;
            color: #111;
        }

        .sectionTitle {
            font-size: 20px;
            font-weight: 900;
            margin: 2px 0 8px;
        }

        .steps {
            margin: 0;
            padding-left: 22px;
            font-size: 18px;
            line-height: 1.75;
        }

        .steps li {
            margin: 6px 0;
        }

        .pill {
            display: inline-block;
            padding: 2px 10px;
            border: 2px solid #ccc;
            border-radius: 999px;
            background: #f7f7f7;
            font-weight: 800;
        }

        .small {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
            margin-top: 8px;
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 13px;
            word-break: break-all;
            color: #333;
        }

        .hidden {
            display: none;
        }

        .okmsg {
            font-size: 16px;
            color: #0a6;
            font-weight: 800;
            margin-top: 8px;
        }

        hr {
            border: none;
            border-top: 2px solid #eee;
            margin: 14px 0;
        }

        /* iPhone向け：クリック後に出す“強い案内” */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .62);
            display: none;
            padding: 16px;
            box-sizing: border-box;
            z-index: 9999;
        }

        .overlay.show {
            display: block;
        }

        .ovcard {
            background: #fff;
            border-radius: 18px;
            padding: 16px;
            max-width: 720px;
            margin: 0 auto;
            border: 2px solid #ddd;
        }

        .ovtitle {
            font-size: 22px;
            font-weight: 900;
            margin: 0 0 8px;
            line-height: 1.35;
        }

        .ovtext {
            font-size: 18px;
            line-height: 1.7;
            margin: 0 0 10px;
        }

        .close {
            font-size: 16px;
            font-weight: 900;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <!-- ★自治体名だけここを変える（例：蕨（わらび）／戸田（とだ）） -->
        <div class="title">自治体名<br>掲示場ナビ</div>

        <p class="sub">
            LINEの中で他のLINE操作をすると画面が消えることがあります。<br>
            <b>Chrome / Safari</b> でひらいてください。
        </p>

        <div class="card warn">
            <div class="device" id="deviceLine">端末を確認中…</div>
            <p class="hint" id="deviceHint">下のボタンを押してください。</p>
        </div>

        <!-- ボタンは1つだけ。文言は統一 -->
        <a id="mainBtn" class="bigbtn hidden" href="#">このボタンを押す</a>

        <div class="card">
            <div class="sectionTitle">うまくいかないとき</div>
            <ol class="steps">
                <li><b>「URLをコピー」</b> を押す</li>
                <li>Chrome / Safari をひらく</li>
                <li>上のアドレス欄に <b>はりつける</b></li>
            </ol>

            <a id="copyBtn" class="bigbtn secondary" href="javascript:void(0)">URLをコピー</a>
            <div id="copied" class="okmsg hidden">コピーしました。Chrome/Safariをひらいて はりつけてください。</div>

            <div class="small">コピーされるURL：</div>
            <div id="fullUrl" class="mono"></div>

            <div class="small">
                ※ 右下か右上にある <span class="pill">︙</span> や <span class="pill">□↑</span> から
                「ブラウザーで開く」が選べることがあります。
            </div>
        </div>

        <div class="small">
            ※ iPhoneは、ページからSafariを“自動で起動”できない場合があります。そのときは上の手順を使ってください。
        </div>
    </div>

    <!-- iPhoneクリック後の“強い案内” -->
    <div id="overlay" class="overlay" role="dialog" aria-modal="true">
        <div class="ovcard">
            <div class="ovtitle">iPhoneの方へ</div>
            <p class="ovtext">
                右下か右上にある <span class="pill">︙</span> か <span class="pill">□↑</span>を押して、<br>
                <b>「ブラウザで開く / Safariで開く」</b> を選んでください。<br><br>
                うまく出ないときは、下の「URLをコピー」を押して、Safariの上に貼り付けてください。
            </p>
            <a class="bigbtn secondary close" href="javascript:void(0)" id="closeOverlay">閉じる</a>
        </div>
    </div>

    <script>
        (function () {
            const ua = navigator.userAgent || "";
            const isAndroid = /Android/i.test(ua);
            const isIOS = /iPhone|iPad|iPod/i.test(ua);

            const baseUrl = location.href.split("#")[0].split("?")[0];
            const navUrl = new URL("./index.html", baseUrl).toString();

            const deviceLine = document.getElementById("deviceLine");
            const deviceHint = document.getElementById("deviceHint");
            const mainBtn = document.getElementById("mainBtn");
            const overlay = document.getElementById("overlay");
            const closeOverlay = document.getElementById("closeOverlay");

            document.getElementById("fullUrl").textContent = navUrl;

            function showCopied() {
                const copied = document.getElementById("copied");
                copied.classList.remove("hidden");
                setTimeout(() => copied.classList.add("hidden"), 2600);
            }

            async function copyUrl() {
                try {
                    await navigator.clipboard.writeText(navUrl);
                } catch (e) {
                    const ta = document.createElement("textarea");
                    ta.value = navUrl;
                    ta.style.position = "fixed";
                    ta.style.left = "-9999px";
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand("copy");
                    document.body.removeChild(ta);
                }
                showCopied();
            }

            // メインボタンの設定
            if (isAndroid) {
                deviceLine.textContent = "この端末：Android";
                deviceHint.textContent = "このボタンを押す → Chromeに切り替わります。";
                const afterScheme = navUrl.replace(/^https?:\/\//, "");
                const intentUrl = "intent://" + afterScheme + "#Intent;scheme=https;package=com.android.chrome;end";
                mainBtn.href = intentUrl;
                mainBtn.textContent = "このボタンを押す";
                mainBtn.classList.remove("hidden");
            } else if (isIOS) {
                deviceLine.textContent = "この端末：iPhone";
                deviceHint.textContent = "このボタンを押したあと、<span class="pill">︙</span> や <span class="pill">□↑</span>を「ブラウザー / Safariで開く」";
                mainBtn.href = navUrl; // 同じWebViewで開くことがあるが、クリックの“きっかけ”が重要
                mainBtn.textContent = "このボタンを押す";
                mainBtn.classList.remove("hidden");

                // iPhone: クリック時に共有シートを試し、同時にURLコピー＋強い案内を出す
                mainBtn.addEventListener("click", async (e) => {
                    // クリックを“ユーザー操作”として使う
                    e.preventDefault();

                    // まずコピー（失敗してもフォールバックあり）
                    await copyUrl();

                    // 共有シート（出れば「Safariで開く」が現れやすい）
                    if (navigator.share) {
                        try {
                            await navigator.share({ title: document.title, url: navUrl });
                            return;
                        } catch (err) {
                            // キャンセル含めて無視し、案内を表示
                        }
                    }

                    // 共有が無理/キャンセルの場合：案内を強制表示
                    overlay.classList.add("show");

                    // 一応URLへも遷移（同一WebView内の可能性はある）
                    setTimeout(() => { location.href = navUrl; }, 300);
                });
            } else {
                deviceLine.textContent = "この端末：不明";
                deviceHint.textContent = "下の「URLをコピー」を使ってください。";
                mainBtn.href = navUrl;
                mainBtn.textContent = "このボタンを押す";
                mainBtn.classList.remove("hidden");
            }

            // URLコピー
            document.getElementById("copyBtn").addEventListener("click", copyUrl);

            // overlay close
            closeOverlay.addEventListener("click", () => overlay.classList.remove("show"));
            overlay.addEventListener("click", (e) => { if (e.target === overlay) overlay.classList.remove("show"); });
        })();
    </script>
</body>

</html>